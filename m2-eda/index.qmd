---
title: ". "
title-slide-attributes:
  data-background-image: "plot/eda.png"
  data-background-size: "cover"
format: 
  revealjs:
    theme: [simple, custom.scss]
    preview-links: true
    code-fold: false
    code-summary: "code"
    chalkboard: true
    slide-number: true
    footer: "Econ 115a: Econometrics"
    quiz:
      defaultCorrect: "Correct!"
      defaultIncorrect: "Incorrect!"
revealjs-plugins:
  - quiz
engine: knitr
from: markdown+emoji
editor: visual
---

```{r}
#| echo: false
#| include: false
knitr::opts_chunk$set(comment = "", 
                      collapse = TRUE,
                      fig.align = "center",
                      fig.width = 8,
                      fig.height = 7
                      )

## working directory
setwd("C:/Users/chris/Documents/Github-repository/econ115a-lectures/m2-eda")
# setwd("D:/Githu-repository/econ115a-lectures/m2-eda")

## Libraries
library(tidyverse)
library(glue)
library(patchwork)

# reading data
wildlife_impacts <- read_csv("data/wildlife_impacts.csv")
days_to_ship <- tibble(
  order = seq(12),
  warehouseA = c(3,3,3,4,4,4,5,5,5,5,5,5),
  warehouseB = c(1,1,1,3,3,4,5,5,5,6,7,10))

# setting the theme
theme_set(theme_bw(base_size = 18)) # Set theme for all ggplots

```

## Lessons

-   

    -   Overview of EDA
    -   Descriptive statistics
    -   Data visualization



# Exploratory data analysis (EDA): an overview



## EDA: an introduction

-   EDA is an iterative cycle that helps you understand what your data says. It involves:
    -   Generate questions about your data
    -   Search for answers by visualizing, transforming, and modeling your data
    -   Use what you learn to refine your questions and/or generate new questions



## EDA: an introduction

Your goal during EDA is to develop an understanding of your data.

> “Far better an approximate answer to the right question, which is often vague, than an exact answer to the wrong question, which can always be made precise.” — John Tukey



## EDA: two useful questions

There is no rule about which questions you should ask to guide your research. However, two questions are particularly useful:

1.  What type of variation occurs within my variables?

2.  What type of covariation occurs between my variables?



## Is EDA a tool for discovery or confirmation? {.quiz-question}

-   [Discovery]{.correct data-explanation="Correct! EDA is a tool for discovery; in fact, EDA is one of the most fruitful tools for discovery in science. We’ll focus on discovery throughout this primer, but remember that you should test any pattern that you discover before you rely on it."}

-   [Confirmation]{data-explanation="Not quite. EDA reveals patterns, but it does not confirm that those patterns exist beyond your data set."}

## When you begin to explore data, is it better to formulate one or two high-quality questions to ask, or many, many questions to explore? {.quiz-question}

-   [One or two high-quality questions]{data-explanation="Not quite. It is hard to spot useful questions ahead of time because you don’t know which discoveries are waiting in your data."}

-   [Many, many questions]{.correct data-explanation="Correct! Each question you ask creates a new opportunity to discover something surprising. You can lead yourself to high-value questions by iterating on questions that reveal unexpected results."}



# Descriptive statistics



## Centrality (aka the "Average" value)

A single number representing the *middle* of a set of numbers

<br>

::: incremental
-   **Mean**: $\frac{\text{Sum of values}}{\text{# of values}}$

-   **Median**: "Middle" value (50% of data above & below)

-   **Mode**: Most frequent value (usually for categorical data)
:::



## Centrality (aka the "average" value)

### Mean is not the always "best" choice

<br>

::::: columns
::: {.column width="40%"}
```{r}
#| echo: true

wildlife_impacts %>%
    filter(! is.na(height)) %>%
    summarise(
      mean = mean(height),
      median = median(height))
```

<br>

Percent of data below mean:

```{r}
#| echo: true

percentiles <- ecdf(wildlife_impacts$height)
meanP <- percentiles(mean(wildlife_impacts$height, na.rm = TRUE))
paste0(round(100*meanP, 1), '%')
```
:::

::: {.column width="60%"}
```{r}
knitr::include_graphics("plot/wildlife_impacts_hist.png")
```
:::
:::::

## Variability ("spread")

-   **Standard deviation**: distribution of values relative to the mean

    -   $s = \sqrt{\frac{\sum_{i=1}^{N}(x_i - \bar{x})^2}{N - 1}}$

-   **Interquartile range (IQR)**: $Q_3 - Q_1$ (middle 50% of data)

-   **Range**: max - min

## Variability ("spread")

-
  -   Complaints are coming in about orders shipped from warehouse B, so you collect some data.

<br>

  -   ... here **averages** are misleading

::::: columns
::: {.column width="50%"}
```{r}
#| echo: true
days_to_ship
```
:::

::: {.column width="50%"}
``` {.r code-line-numbers="5-6"}
days_to_ship |> 
  pivot_longer(-order, names_to = "warehouse", values_to = "days") |> 
  group_by(warehouse) |>
  summarise(
    mean = mean(days),
    median = median(days))
```

```{r}
days_to_ship |> 
  pivot_longer(-order, names_to = "warehouse", values_to = "days") |> 
  group_by(warehouse) |>
  summarise(
    mean = mean(days),
    median = median(days))
```
:::
:::::

## Variability ("spread")

-
  -   Complaints are coming in about orders shipped from warehouse B, so you collect some data:
  
<br>

-   **variability** reveals difference in days to ship

::::: columns

::: {.column width="50%"}
```{r}
#| echo: true
days_to_ship
```
:::

::: {.column width="50%"}
``` {.r code-line-numbers="5-8"}
days_to_ship |> 
  pivot_longer(-order, names_to = "warehouse", values_to = "days") |> 
  group_by(warehouse) |>
  summarise(
    mean = mean(days),
    sd = sd(days),
    iqr = IQR(days),
    range = max(days) - min(days))
```

```{r}
days_to_ship |> 
  pivot_longer(-order, names_to = "warehouse", values_to = "days") |> 
  group_by(warehouse) |>
  summarise(
    mean = mean(days),
    sd = sd(days),
    iqr = IQR(days),
    range = max(days) - min(days))
```
:::
:::::

## Variability ("spread")

<br>

```{r}
knitr::include_graphics("plot/days_to_ship.png")
```

## Outliers

**Mean** and **standard deviation** are sensitive to outliers

-   **Outliers**: $Q_1 - 1.5 IQR$ \* $Q_3 + 1.5 IQR$

-   **Extreme values**: $Q_1 - 3 IQR$ \* $Q_3 + 3 IQR$

<br>

::::: columns
::: {.column width="50%"}
```{r}
#| echo: true
data1 <- c(3,3,4,5,5,6,6,7,8,9)
```

-
  -   Mean: `r round(mean(data1), 2)`
  
  -   Standard deviation: `r round(sd(data1), 2)`
  
  -   Median: `r median(data1)`
  
  -   IQR: `r IQR(data1)`
:::

::: {.column width="50%"}
```{r}
#| echo: true
data2 <- c(3,3,4,5,5,6,6,7,8,20)
```

-
  -   Mean: `r mean(data2)`
  
  -   Standard deviation: `r round(sd(data2), 2)`
  
  -   Median: `r median(data2)`
  
  -   IQR: `r IQR(data2)`\
:::
:::::

## Outliers

<br>

![](plot/boxplot-iqr.png){width="70%" height="70%" fig-align="center"}

::: {style="font-size: 70%; text-align: center;"}
Source: [Data Science Discovery](https://discovery.cs.illinois.edu/learn/Exploratory-Data-Analysis/Quartiles-and-Box-Plots/)
:::



## Outliers

Robust statistics for continuous data (less sensitive to outliers)

-
  -   **Centrality**: use *median* rather than *mean*
  
  -   **Variability**: use *IQR* rather than *standard deviation*



## Descriptive statistics table

```{r}
#| echo: true

library(vtable)

st(gapminder::gapminder |> select(-country, -continent, -year))


```


## Descriptive statistics table

```{r}
#| echo: true
library(frontier)
data(riceProdPhil)

st(riceProdPhil |> select(PROD:EDYRS))
```



## Which of the following measures is used to represent the central tendency of a dataset? {.quiz-question}

-   [Mean]{.correct data-explanation="The mean is a measure of central tendency that represents the average value of a dataset. It is calculated by summing all the values and dividing by the number of values."}

-   Variance

-   Range

-   Standard deviation



## What does the term 'variability' in descriptive statistics refer to? {.quiz-question}

- [The spread of data values]{.correct data-explanation="Correct! Variability refers to how spread out the data values are. It includes measures such as range, variance, and standard deviation, which describe the dispersion of data points."}

- The average value of the data

- The number of data points

- The typde of data collected



## Which visualization tool is most useful for identifying outliers in a dataset? {.quiz-question}

- Pie chart

- Histogram

- [Boxplot]{.correct data-explanation="Correct! A boxplot is particularly useful for identifying outliers. It displays the median, quartiles, and potential outliers as points outside the whiskers of the plot."}

- Line graph



## Which of the following statements about the mean and median is always true for a perfectly symmetric distribution? {.quiz-question}

- Mean is greater than median

- [Mean equals median]{.correct data-explanation="Correct! In a perfectly symmetric distribution, the mean, median, and mode all coincide."}

- Median is greater than mode

- Mean equals mode



## If a dataset has a high standard deviation but a low interquartile range (IQR), what does this suggest? {.quiz-question}

- The data is uniformly distributed

- [There are likely outliers]{.correct data-explanation="Correct! A high standard deviation with a low IQR suggests that most data is clustered but a few extreme values are pulling the standard deviation upward."}

- The data is normally distributed

- The mean is unreliable



## Which measure is most robust to outliers? {.quiz-question}

- Mean

- Range

- [Median]{.correct data-explanation="Correct! The median is resistant to outliers because it depends only on the middle value(s), not the magnitude of extremes."}

- standard deviation



## Which of the following is a misleading use of descriptive statistics? {.quiz-question}

- [Reporting the mean income in a highly skewed distribution.]{.correct data-explanation="Correct! In skewed distributions (like income), the mean can be distorted by extreme values and may not reflect the typical case."}

- Using the median to describe symmetric data.

- Reporting both mean and standard deviation for normal data.

- Using IQR to describe variability in ordinal data.


    
# EDA using data viz


## "Visualizing data helps us think"

```{r}
#| echo: true
anscombe |> tibble()
```

```{r}
#| echo: false
anscombe_summary_stats <- 
  anscombe |> 
  psych::describe() |> 
  select(mean, sd) |> 
  # tranform to column iwth rownames as column
  rownames_to_column("variable") |> 
  tibble() |> 
  pivot_longer(cols = c(mean, sd), names_to = "statistic", values_to = "value") |> 
  pivot_wider(names_from = variable, values_from = value)
```

<br>

```{r}
#| echo: true
anscombe_summary_stats
```

## Anscombe's Quartet

-   Stephen Few (2009, p6)

```{r}
knitr::include_graphics("plot/p_corr_anscombe.png")
```

## Data types determines how to summarize it

<br>

+-----------------------+----------------------+------------------------------------+
| Nominal (categorical) | Ordinal (categorical | Numerical (continuous)             |
+=======================+======================+====================================+
| **Measures**          | **Measures**         | **Measures**                       |
|                       |                      |                                    |
| -   Frequency counts  | -   Frequency counts | -   Mean, median                   |
| -   proportions       | -   proportions      | -   Range, standard deviation, IQR |
|                       | -   Median, mode     |                                    |
|                       | -   IQR              |                                    |
+-----------------------+----------------------+------------------------------------+
| **Charts**            | **Charts**           | **Charts**                         |
|                       |                      |                                    |
| -   Bars              | -   Bars             | -   Histogram                      |
|                       |                      | -   Boxplot                        |
+-----------------------+----------------------+------------------------------------+

## Summarizing categorical data

## Summarizing numerical data

## Summarizing Nominal data

::::: columns
::: {.column width="50%"}
Summarize with counts/ percentages

```{r}
#| echo: true

wildlife_impacts |> 
  count(operator, sort = TRUE) |> 
  mutate(percent = n / sum(n))
```
:::

::: {.column width="50%"}
Visualize with bars

```{r}
#| echo: true
#| eval: false

wildlife_impacts |> 
  count(operator, sort = TRUE) |> 
  ggplot(aes(x = fct_reorder(operator, n), y = n)) +
  geom_col() +
  coord_flip() +
  labs(x = "Operator", y = "Count") +
  theme_minimal()
```

```{r}
knitr::include_graphics("plot/nominal_barplot.jpeg")
```
:::
:::::

## Summarizing Ordinal data

::::: columns
::: {.column width="50%"}
Summarize: counts/ percentages

```{r}
#| echo: true
wildlife_impacts |> 
  count(incident_month, sort = TRUE) |> 
  mutate(percent = n / sum(n))
```
:::

::: {.column width="50%"}
Visualize: bars

```{r}
#| echo: true
#| eval: false

wildlife_impacts |> 
  count(incident_month, sort = TRUE) |> 
  ggplot(aes(x = as.factor(incident_month), y = n)) +
  geom_col() +
  labs(x = "Incident Month", y = "Count") 
```

```{r}
knitr::include_graphics("plot/ordinal_barplot.jpeg")
```
:::
:::::

## Summarizing continuous data

::::: columns
::: {.column width="50%"}
**Histograms**:

-   Skewness

-   Number of modes

<br>

**Boxplots**:

-   Outliers

-   Comparing variablesn
:::

::: {.column width="50%"}
```{r}
knitr::include_graphics("plot/eda-boxplot.png")
```
:::
:::::

## **Histogram**: Identify Skewness & \# of Modes

::::: columns
::: {.column width="50%"}
**Summarise**:

-   Mean, median, sd, range, & IQR:

```{r}
summary(wildlife_impacts$height)
```
:::

::: {.column width="50%"}
**Visualize**:

-   Histogram (identify skewness & modes)

```{r wildlife-height-hist, fig.width=7, fig.height=5, fig.align='center'}
ggplot(wildlife_impacts) +
  geom_histogram(aes(x = height), bins = 50) + #<<
  labs(x = 'Height (ft)', y = 'Count')
```
:::
:::::

## Histogram: Identify Skewness & of Modes

::::: columns
::: {.column width="50%"}
**Height**

```{r, ref.label="wildlife-height-hist", fig.width=7, fig.height=5, fig.align='center'}
```
:::

::: {.column width="50%"}
**Speed**

```{r wildlife-speed-hist, fig.width=7, fig.height=5, fig.align='center'}
ggplot(wildlife_impacts) +
  geom_histogram(aes(x = speed), bins = 50) + #<<
  labs(x = 'speed (mph)', y = 'Count')
```
:::
:::::

## Boxplot: Identify outliers

::::: columns
::: {.column width="50%"}
**Height**

```{r wildlife-height-boxplot, fig.width=7, fig.height=4, fig.align='center'}
ggplot(wildlife_impacts) +
    geom_boxplot(aes(x = height)) + #<<
    labs(x = 'Height (ft)', y = NULL)
```
:::

::: {.column width="50%"}
**Speed**

```{r wildlife-speed-boxplot, fig.width=7, fig.height=4, fig.align='center'}
ggplot(wildlife_impacts) +
    geom_boxplot(aes(x = speed)) + #<<
    labs(x = 'Speed (mph)', y = NULL)
```
:::
:::::

## Histogram and Boxplot

::::: columns
::: {.column width="50%"}
**Histogram**

-   Skewness
-   Modes

```{r, ref.label="wildlife-speed-hist", echo=FALSE, fig.width=7, fig.height=5, fig.align='center'}
```
:::

::: {.column width="50%"}
**Boxplot**

-   Outliers

<br><br>

```{r, ref.label="wildlife-speed-boxplot", echo=FALSE, fig.width=7, fig.height=5, fig.align='center'}
```
:::
:::::

# Presenting data using data visualization

## Data visualization

> The simple graph has brought more information to the data analyst’s mind than any other device. — John Tukey

-   

    -   data visualization is a key part of EDA
    -   data visualization is the creation and study of the visual representation of data
    -   Several tools are available for visualizing data - **R** is one of them

## Data reproducibility and replicability

<br>

::::: columns
::: column
### Reproducibility {.center-text}

-   Obtaining computational results using the same input data, computational steps, methods, code and conditions of analysis.
:::

::: column
### Replicability {.center-text}

-   Obtaining consistent results across studies aimed at answering the same scientific question, each of which has obtained its own data.
:::
:::::

<br>

::: {.source-text-smaller .center-text}
[Source: National Academies of Sciences, Engineering, and Medicine. 2019. Reproducibility and Replicability in Science. Washington, DC: The National Academy Press, https://doi.org/10.17226/25303](https://doi.org/10.17226/25303)
:::

## Data reproducibility and replicability

<br>

::::: columns
::: column
### Reproducibility {.center-text}

-   

    -   same procedures
    -   same data
    -   same code
:::

::: column
### Replicability {.center-text}

-   

    -   same procedures
    -   new data
    -   new code
:::
:::::

## Data reproducibility and replicability

![](plot/reproduce-replicate-issue.png){fig-align="center" width="50%" height="50%"}

::: {.source-text-smaller .center-text}
[Source: Baker, M. (2016). 1,500 scientists lift the lid on reproducibility. Nature, 533(7604), Article 7604. https://doi.org/10.1038/533452a](https://doi.org/10.1038/533452a)
:::

## Data reproducibility and replicability

![](plot/rep-rep-bar.png){fig-align="center" width="105%" height="105%"}

::: {.source-text-smaller .center-text}
[Source: Baker, M. (2016). 1,500 scientists lift the lid on reproducibility. Nature, 533(7604), Article 7604. https://doi.org/10.1038/533452a](https://doi.org/10.1038/533452a)
:::

## Data exploration vs. data presentation

<br>

+----------------------+----------------------------+------------------------------------+
| Aspect               | Data exploration           | Data presentation                  |
+======================+============================+====================================+
| Goal                 | Discover insights          | Communicate findings               |
+----------------------+----------------------------+------------------------------------+
| Priority             | Speed and flexibility      | Visual polish and clarity          |
+----------------------+----------------------------+------------------------------------+
| Acceptable output    | Rough, quick plots         | Refined, publication-ready figures |
+----------------------+----------------------------+------------------------------------+
| Tool preference      | Dynamic, exploratory tools | Designed-focus hybrid tools        |
+----------------------+----------------------------+------------------------------------+
| Reproducibility risk | Low concern                | High concern-avoid manual edits    |
+----------------------+----------------------------+------------------------------------+

::: {.source-text-smaller .center-text}
[Source: Wilke, C. (2020). Fundamentals of data visualization. A primer on making informative and compelling figures.](https://clauswilke.com/dataviz/index.html)
:::

## Separation of content and design

<br>

+-----------------------+-----------------------------------+-----------------------------------------+
| Component             | Content                           | Design                                  |
+=======================+===================================+=========================================+
| Focus                 | Data, transformation, plot types  | Aesthetics, layout, visual polish       |
+-----------------------+-----------------------------------+-----------------------------------------+
| Examples              | Scatter plot of unemployment data | Font style, background color, gridlines |
+-----------------------+-----------------------------------+-----------------------------------------+
| Tools                 | Data mapping functions            | Themes, style sheets                    |
+-----------------------+-----------------------------------+-----------------------------------------+
| Benefit               | Analytical clarity                | Visual consistency and appeal           |
+-----------------------+-----------------------------------+-----------------------------------------+

## 
